# 游戏配置表使用说明

## 概述

本目录包含所有游戏配置表的CSV模板文件。这些模板文件可以直接用Excel打开编辑，然后通过转换工具转换为游戏使用的JSON格式。

## 配置表清单

### 1. ExplorerConfig_template.csv - 角色配置表
配置所有探险者的基础属性、天赋和科技树。

**字段说明：**
- `ID`: 角色唯一标识符（英文+下划线，如 `explorer_alice`）
- `名称Key`: 文本Key，用于多语言显示角色名称（如 `explorer.alice.name`）
- `描述Key`: 文本Key，用于多语言显示角色描述（如 `explorer.alice.desc`）
- `末日前身份标签`: 角色的末日前身份（如：工程师、医生、军人）
- `最大血量`: 角色的血量上限（整数）
- `初始血量`: 角色首次创建时的初始血量（整数，默认等于最大血量）
- `最大体力`: 角色的体力上限（整数）
- `初始体力`: 角色首次创建时的初始体力（整数，默认等于最大体力）
- `攻击力`: 角色的基础攻击力（整数）
- `初始天赋ID列表`: 角色初始拥有的天赋ID，多个用竖线 `|` 分隔（如 `talent_1|talent_2`）
- `初始科技树解锁项ID列表`: 角色初始解锁的科技项ID，多个用竖线 `|` 分隔

### 2. TechTreeConfig_template.csv - 科技树配置表
配置所有科技树节点的信息。

**字段说明：**
- `ID`: 科技项唯一标识符
- `名称Key`: 文本Key，用于多语言显示科技名称
- `描述Key`: 文本Key，用于多语言显示科技描述
- `所属分支`: 科技所属分支（体魄/智力/谋略）
- `解锁条件类型`: 解锁条件类型（科技点/专属道具）
- `解锁条件值`: 解锁所需数值（如科技点数量）
- `效果类型`: 科技效果类型（如：血量上限、资源收集种类、探索效率）
- `效果数值`: 科技效果的具体数值
- `前置科技ID`: 前置科技ID（如果存在）

### 3. MonsterConfig_template.csv - 怪物配置表
配置所有怪物的属性、出现条件和掉落。

**字段说明：**
- `ID`: 怪物唯一标识符
- `名称Key`: 文本Key，用于多语言显示怪物名称
- `描述Key`: 文本Key，用于多语言显示怪物描述
- `血量`: 怪物的血量（整数）
- `攻击力`: 怪物的攻击力（整数）
- `出现时间段`: 怪物出现的时间段（白天/傍晚/深夜）
- `出现概率`: 怪物出现的概率（0-1之间的小数，如0.8表示80%）
- `掉落资源ID列表`: 怪物掉落的资源ID，多个用竖线 `|` 分隔
- `掉落资源数量范围`: 掉落数量范围（格式：`最小|最大`，如 `1|3`）

### 4. MapConfig_template.csv - 地图配置表
配置地图上每个格子的信息。

**字段说明：**
- `X坐标`: 格子的X坐标（整数）
- `Y坐标`: 格子的Y坐标（整数）
- `格子类型`: 格子类型（避难所/道路/探索点/空地/已建设地点）
- `初始状态`: 格子的初始状态（已建设/已解锁/未探索）
- `资源生成规则ID`: 资源生成规则ID（如果适用）
- `可建设类型`: 该格子可建设的建筑类型（如果适用）

### 5. ExplorationPointConfig_template.csv - 探索点配置表
配置所有探索点的信息。

**字段说明：**
- `ID`: 探索点唯一标识符
- `名称Key`: 文本Key，用于多语言显示探索点名称
- `描述Key`: 文本Key，用于多语言显示探索点描述
- `位置X`: 探索点在地图上的X坐标
- `位置Y`: 探索点在地图上的Y坐标
- `最大层数`: 该探索点一次进入可探索的最大层数（整数，达到后强制结束探索）
- `探索难度`: 探索难度（简单/中等/困难）
- `棋盘出现内容`: 探索棋盘上可出现的单位及其权重配置，使用竖线 `|` 分隔多个条目，每个条目使用下划线 `_` 分隔为三个部分：`出现类型_具体ID_出现权重值`。例如：`Monster_monster_zombie_10|Garbage_garbage_trash_5` 表示：\n  - 在棋盘生成时，有一个怪物 `monster_zombie`，权重为10；\n  - 有一个垃圾 `garbage_trash`，权重为5。出现类型当前支持 `Monster`（怪物）、`Garbage`（垃圾），后续可扩展。

### 6. ResourceConfig_template.csv - 资源配置表
配置所有资源的信息。

**字段说明：**
- `ID`: 资源唯一标识符
- `名称Key`: 文本Key，用于多语言显示资源名称
- `描述Key`: 文本Key，用于多语言显示资源描述
- `基础产出`: 资源的基础产出数值（整数）
- `稀有度`: 资源稀有度（普通/稀有/特殊）
- `资源类型`: 资源类型（食物/水/材料/科技点等）
- `堆叠最大数量`: 该资源在背包中1个格子上最多可以堆叠的数量（整数，如99表示1个格子最多堆叠99个），超过此数量需占用新格子

### 7. ItemConfig_template.csv - 道具配置表
配置所有道具的信息。

**字段说明：**
- `ID`: 道具唯一标识符
- `名称Key`: 文本Key，用于多语言显示道具名称
- `描述Key`: 文本Key，用于多语言显示道具描述
- `道具类型`: 道具类型（消耗品/专属道具/装备等）
- `使用效果类型`: 使用效果类型（恢复血量/恢复体力/解锁科技/升级天赋等）
- `使用效果数值`: 使用效果的具体数值
- `消耗条件`: 使用道具的消耗条件（如需要指定科技ID或天赋ID）
- `堆叠最大数量`: 该道具在背包中1个格子上最多可以堆叠的数量（整数，如10表示1个格子最多堆叠10个），超过此数量需占用新格子

### 8. ShelterLevelConfig_template.csv - 避难所等级配置表
配置避难所各等级的信息。

**字段说明：**
- `等级`: 避难所等级（整数，从1开始）
- `默认解锁设施ID列表`: 达到该等级时自动解锁/建成的设施ID，多个用逗号分隔
- `可建造设施ID列表`: 从该等级开始允许建造的设施ID，多个用逗号分隔
- `最大设施数量`: 该等级下避难所可容纳的最大设施数量（整数，可选）
- `升级前置条件资源ID`: 升级到该等级所需的资源ID（可选）
- `升级前置条件资源数量`: 升级到该等级所需的资源数量（整数，可选）
- `初始工具ID列表`: 达到该等级时自动添加到仓库的工具ID列表，多个用竖线 `|` 分隔（如 `equipment_tool_1_sieve|equipment_tool_2_trap`）。工具ID必须存在于 `EquipmentConfig` 中。每个等级的工具只会在首次达到该等级时添加一次。

### 9. GarbageConfig_template.csv - 垃圾配置表
配置所有出现在探索棋盘上的垃圾单位信息。

**字段说明：**
- `ID`: 垃圾唯一标识符（garbageId），如 `garbage_trash_metal_1`
- `名称Key`: 文本Key，用于多语言显示垃圾名称
- `描述Key`: 文本Key，用于多语言显示垃圾描述，可在文案中使用 `{icon:图标ID}` 形式的占位符插入图标（例如展示触发进阶产出机制所需的角色或资源图标）
- `默认搜索产出`: 当该垃圾被正常搜刮时的基础产出，格式为 `资源ID_数量` 列表，多个条目用竖线 `|` 分隔，例如 `resource_metal_1|resource_food_1`
- `垃圾类型列表`: 该垃圾所属的类型标签列表，用于与角色技能的触发条件匹配，多个类型用竖线 `|` 分隔，例如 `废金属|可燃物`
- `进阶产出机制ID列表`: 引用进阶产出机制配置表 `AdvancedOutputConditionConfig` 中的机制ID，多个ID用竖线 `|` 分隔，例如 `condition_example_engineer`
- `进阶产出`: 当满足任一进阶产出机制时，用于替代默认搜索产出的高级产出配置，格式同“默认搜索产出”，例如 `resource_metal_3|resource_rare_chip_1`

### 10. AdvancedOutputConditionConfig_template.csv - 进阶产出机制配置表
配置所有可复用的进阶产出触发机制。

**字段说明：**
- `ID`: 进阶产出机制唯一标识符（conditionId），如 `condition_example_engineer`
- `名称Key`: 文本Key，用于多语言显示该机制名称
- `描述Key`: 文本Key，用于多语言显示该机制描述，可使用 `{icon:图标ID}` 占位符直观展示触发条件与额外产出
- `适用垃圾类型列表`: 该机制适用的垃圾类型标签列表，多个类型用竖线 `|` 分隔；当某个垃圾的“垃圾类型列表”与此处至少有一个类型相同时，该机制对该垃圾有效
- `触发条件类型`: 触发条件的大类，用于代码侧区分逻辑分支，例如：`ExplorerTagCount`（需要一定数量带某标签的角色）、`Difficulty`（探索点难度）、`Mixed`（复杂组合）等
- `触发条件参数`: 以字符串形式存储的条件参数（例如 `ExplorerTag=Engineer;MinCount=2` 或JSON字符串），由游戏逻辑解析并决定何时触发进阶产出

### 11. SkillConfig_template.csv - 技能配置表
配置所有角色技能的信息。技能以 `skillId` 为唯一标识，对应代码中的技能效果处理函数。

**字段说明：**
- `ID`: 技能唯一标识符（skillId），如 `Skill_EnergyShield`
- `名称Key`: 文本Key，用于多语言显示技能名称
- `描述Key`: 文本Key，用于多语言显示技能描述，可在文案中使用 `{icon:图标ID}` 插入图标
- `效果类型`: 用于策划侧归类技能的大致类型（例如 `BattleBuff`、`ExploreBuff`、`ExtraDrop` 等），便于筛选和统计
- `效果参数`: 技能效果参数字符串，由代码解析，例如 `shieldRate=0.2;durationRounds=3` 或 JSON 字符串
- `触发时机`: 技能结算时机，例如 `OnBattleStart`、`OnAttack`、`OnGarbageSearched`、`OnEnterExplorationBoard` 等
- `作用目标`: 技能作用目标范围，例如 `Self`（自身）、`CurrentExplorer`（当前执行动作的角色）、`Team`（当前小队全体）等
- `消耗道具ID`: （可选）学习或激活该技能需要消耗的道具ID（对应 `ItemConfig` 的 `ID`），如不需要可留空

### 12. TalentConfig_template.csv - 天赋配置表
配置所有可被角色持有的天赋信息。天赋以 `talentId` 为唯一标识，对应代码中的天赋效果处理函数。

**字段说明：**
- `ID`: 天赋唯一标识符（talentId），如 `Talent_HardenedExplorer`
- `名称Key`: 文本Key，用于多语言显示天赋名称
- `描述Key`: 文本Key，用于多语言显示天赋描述，可在文案中使用 `{icon:图标ID}` 插入图标
- `效果类型`: 用于策划侧归类天赋的大致类型，例如 `PermanentBuff`、`BattleBuff`、`ExploreBuff` 等
- `效果参数`: 天赋效果参数字符串，由代码解析，例如 `maxHpBonus=20` 或 JSON 字符串
- `解锁条件类型`: 解锁该天赋的条件类型，例如 `TechReached`（达成某科技）、`ShelterLevelReached`（避难所等级达到X）、`StoryFlag`（剧情标记）等
- `解锁条件参数`: 解锁条件参数字符串，例如 `TechId=tech_engineer;Level>=2`
- `是否可叠加`: 标记该天赋是否可以多次获得并叠加效果（true/false）
- `最大叠加层数`: 当 `是否可叠加` 为 true 时，限制最大叠加层数（整数，可选；为空表示不限）

### 13. EquipmentConfig_template.csv - 装备配置表
配置所有可被角色装备的工具/装备信息。装备主要用于在探索棋盘中激活进阶产出效果。

**字段说明：**
- `ID`: 装备唯一标识符（equipmentId），如 `equipment_tool_001`
- `名称Key`: 文本Key，用于多语言显示装备名称（如 `equipment.tool.001.name`）
- `描述Key`: 文本Key，用于多语言显示装备描述（如 `equipment.tool.001.desc`）
- `装备标签列表`: 装备标签列表，用于进阶产出机制的条件匹配，多个标签用竖线 `|` 分隔（如 `工具|食物搜集`）
- `匹配垃圾类型列表`: 该装备可以匹配的垃圾类型列表，用于判断是否对特定垃圾生效，多个类型用竖线 `|` 分隔（如 `食物|水产|食物|野兽`）
- `效果类型`: 装备效果类型，用于代码侧区分不同的效果处理逻辑（如 `EnhanceGarbageOutput`、`TrapFoodBonus`、`HumanNeighborBonus` 等）
- `效果参数`: 效果参数字符串，由代码解析，格式为键值对（如 `TargetSubType=面粉;Range=1;ExtraFoodPerTarget=9`）
- `堆叠最大数量`: 该装备在背包中1个格子上最多可以堆叠的数量（整数，通常为1，表示不可堆叠）

**配置示例：**
- 筛漏（tool_1）：装备标签为"工具|食物搜集"，匹配"食物"类型，效果是增强相邻面粉类食材的产出
- 陷阱（tool_2）：每层可安装1个，50%概率出现在下一层，根据陷阱数量给予食物奖励
- 蜜罐（tool_3）：收集相邻糖果类食材，每个糖果可获得6个食物
- 撬棍（tool_4）：收集相邻材料，每个材料可获得20材料
- 弓箭（tool_5）：收集相邻野兽，每个野兽可获得20食物
- 黑背（tool_6）：与人类相邻时，每个人类增加1食物产出
- 锄头（tool_7）：收集相连的土豆，每个土豆可获得9食物

**注意事项：**
- 装备标签用于在进阶产出机制中通过 `EquipmentTag` 参数进行匹配
- 匹配垃圾类型列表用于判断装备是否对特定垃圾类型生效
- 效果参数的具体格式和含义由代码侧的效果处理函数决定
- 装备可以作为道具存储在背包中，穿戴时从背包移除，卸下时放回背包

### 14. ShipConfig_勘探船配置表.csv - 勘探船配置表
配置勘探船的基础属性，用于怪物入侵系统。

**字段说明：**
- `ID`: 勘探船唯一标识符（如 `ship_default`）
- `名称Key`: 文本Key，用于多语言显示勘探船名称（如 `ship.default.name`）
- `描述Key`: 文本Key，用于多语言显示勘探船描述（可选）
- `初始血量`: 船体初始血量（整数）
- `最大血量`: 船体最大血量（整数）
- `每回合震动值增加值`: 勘探船每回合默认增加的震动值（整数或小数）

**配置示例：**
- 默认勘探船：初始血量100，最大血量100，每回合震动值增加1

### 15. DefenseFacilityConfig_防御设施配置表.csv - 防御设施配置表
配置防御设施的信息，用于怪物入侵防御系统。

**字段说明：**
- `ID`: 设施唯一标识符（如 `facility_turret_basic`）
- `名称Key`: 文本Key，用于多语言显示设施名称
- `描述Key`: 文本Key，用于多语言显示设施描述（可选）
- `设施类型`: 设施类型（如"炮台"、"护盾"等）
- `初始血量`: 设施初始血量（整数）
- `最大血量`: 设施最大血量（整数）
- `攻击力`: 防御设施的攻击力（整数，护盾类为0）
- `攻击范围`: 攻击范围（格子数，整数）
- `攻击速度`: 每秒攻击次数（整数或小数）
- `建造消耗资源列表`: 建造消耗资源，格式：`资源ID_数量|资源ID_数量`（可选）
- `升级消耗资源列表`: 升级消耗资源，格式同上（可选）

**配置示例：**
- 基础炮台：攻击力5，攻击范围3，攻击速度1，建造消耗金属10和食物5
- 基础护盾：血量100，无攻击力，建造消耗金属15和食物10

**注意事项：**
- 建造消耗资源列表和升级消耗资源列表需要引用 `ResourceConfig` 中的资源ID
- 资源ID和数量之间用下划线 `_` 分隔，多个资源用竖线 `|` 分隔

### 16. OreChoiceConfig_矿石选择配置表.csv - 矿石选择配置表
配置每层开始前的三选一矿石类型选项，影响后续所有层的矿石生成。

**字段说明：**
- `ID`: 选择选项唯一标识符（如 `ore_choice_food_focus`）
- `名称Key`: 文本Key，用于多语言显示选项名称
- `描述Key`: 文本Key，用于多语言显示选项描述（可选）
- `影响的矿石ID列表`: 影响的矿石ID列表，多个用竖线 `|` 分隔（如 `garbage_10001|garbage_10002`）
- `权重调整`: 权重倍数（小数，默认1.0，大于1增加出现概率）
- `数量上限`: 该层最多出现多少个该类矿石（整数，可选，默认无限制）
- `图标Key`: 图标资源Key（可选）

**配置示例：**
- 食物聚焦：影响所有食物类矿石，权重调整2.0，数量上限12
- 材料聚焦：影响所有材料类矿石，权重调整2.0，数量上限10
- 平衡选择：影响部分食物和材料矿石，权重调整1.5，数量上限15

**注意事项：**
- 影响的矿石ID列表需要引用 `GarbageConfig` 中的ID
- 多个选项可以累积生效，权重会累加，数量上限取最小值
- 每次进入探索点时，选项列表会重置

## 使用方法

### 方法1：使用Excel编辑（推荐）

1. **打开模板文件**
   - 用Excel打开对应的CSV模板文件（如 `ExplorerConfig_template.csv`）
   - Excel会自动识别CSV格式并正确显示

2. **填写数据**
   - 按照模板格式填写数据
   - 注意保持字段格式正确（数字字段填写数字，列表字段使用竖线 `|` 分隔）
   - 可以删除示例行，添加自己的数据

3. **保存文件**
   - 保存为CSV格式（Excel会提示，选择"是"）
   - 或者保存为Excel格式（.xlsx），后续需要转换为CSV

### 方法2：使用文本编辑器

1. 用文本编辑器（如Notepad++、VS Code）打开CSV文件
2. 按照模板格式填写数据
3. 注意保持CSV格式（逗号分隔列，字段内部使用竖线 `|` 作为列表或范围分隔符；如字段内包含逗号需用引号包裹）

## 转换CSV为JSON

填写完CSV文件后，使用转换工具将其转换为游戏使用的JSON格式：

```bash
# 在项目根目录执行
node tools/csv-to-json.js

# 或者指定输入输出目录
node tools/csv-to-json.js configs/templates configs/json
```

转换后的JSON文件将自动生成到 `configs/json/` 目录下：
- `ExplorerConfig.json`
- `TechTreeConfig.json`
- `MonsterConfig.json`
- `MapConfig.json`
- `ExplorationPointConfig.json`
- `ResourceConfig.json`
- `ItemConfig.json`
- `ShelterLevelConfig.json`
- `EquipmentConfig.json`
- `ShipConfig.json`
- `DefenseFacilityConfig.json`
- `OreChoiceConfig.json`

## 填写注意事项

1. **ID字段**：必须唯一，使用英文+下划线，如 `explorer_alice`、`tech_physique_1`
2. **数值字段**：使用数字，不要包含单位（如直接写 `3` 而不是 `3点`）
3. **列表字段**：多个值用竖线 `|` 分隔，如 `talent_1|talent_2|talent_3`
4. **范围字段**：使用 `最小|最大` 格式，如 `1|3` 表示1到3
5. **空字段**：如果某个字段不适用，留空即可
6. **文本Key**：使用分层命名方式，如 `explorer.alice.name`、`resource.food.desc`
7. **编码**：建议使用UTF-8编码保存CSV文件，避免中文乱码

## 数据关联关系

配置表之间存在以下关联关系：

1. **ExplorerConfig → TechTreeConfig**: 角色的初始科技树解锁项引用科技树ID
2. **ExplorerConfig → ItemConfig**: 角色的初始天赋可能通过专属道具解锁
3. **ExplorationPointConfig → MonsterConfig**: 探索点的怪物生成规则引用怪物ID
4. **ExplorationPointConfig → ResourceConfig**: 探索点的垃圾生成规则引用资源ID
5. **MonsterConfig → ResourceConfig**: 怪物的掉落资源引用资源ID
6. **ShelterLevelConfig → ItemConfig/ResourceConfig**: 避难所升级条件可能引用资源ID
7. **EquipmentConfig → AdvancedOutputConditionConfig**: 装备的效果参数可能引用进阶产出机制ID
8. **EquipmentConfig → GarbageConfig**: 装备的匹配垃圾类型列表与垃圾的垃圾类型列表进行匹配
9. **ExplorerConfig → EquipmentConfig**: 角色可以装备装备，装备槽位数量在角色配置中定义
10. **DefenseFacilityConfig → ResourceConfig**: 防御设施的建造和升级消耗资源引用资源ID
11. **OreChoiceConfig → GarbageConfig**: 矿石选择配置的影响矿石ID列表引用垃圾ID

## 文件位置

- **模板文件**: `DoomsdaySSW2/configs/templates/*_template.csv`
- **转换后的JSON**: `DoomsdaySSW2/configs/json/*.json`
- **转换工具**: `DoomsdaySSW2/tools/csv-to-json.js`

## 后续处理

转换完成后：
1. 检查生成的JSON文件格式是否正确
2. 验证数据完整性和关联关系
3. 在Unity项目中加载JSON配置表
4. 在游戏中测试配置表数据是否正确生效

## 常见问题

**Q: Excel打开CSV后中文乱码怎么办？**
A: 在Excel中，选择"数据" -> "从文本/CSV导入"，选择UTF-8编码。

**Q: 如何添加新字段？**
A: 在CSV文件中添加新列，转换工具会自动识别并包含在JSON中。

**Q: 列表字段如何填写？**
A: 多个值用竖线 `|` 分隔，如 `item_1|item_2|item_3`，转换工具会自动解析为数组。

**Q: 转换工具报错怎么办？**
A: 检查CSV文件格式是否正确，确保：
- 表头行存在且格式正确
- 数据行与表头列数匹配
- 特殊字符（如逗号）已用引号包裹
- 文件编码为UTF-8
